<!DOCTYPE html>
<html>
    <head>

        <!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Link for jquery required for bootstrap -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <title>Multi Watch</title>
		<link rel="shortcut icon" href="favicon.ico" />
        <script type='text/javascript'>
	    	//globals
	    	var listStopWatch = [];  
	    	var idCounter = 1;  //gives id to the watch object

	    	//given time in seconds returns a string in format hh:mm:ss
	    	function GiveTimeString(remSeconds) {
	    		var secs = remSeconds % 60;
	    		remSeconds = remSeconds - secs;
	    		var mins = (remSeconds/60) % 60;
	    		remSeconds = remSeconds/60 - mins;
	    		var hrs = (remSeconds/60);
	    		if(hrs < 10) hrs = "0" + hrs;
	    		if(mins < 10) mins = "0" + mins;
	    		if(secs < 10) secs = "0" + secs;
	    		return hrs + ":" + mins + ":" + secs;
	    	}

	    	//returns html body for the watch
			function StopWatchBody(Watch) {
				var retStr = "<div class='col-md-6' id='" + Watch.id + "'>" +
							 	"<div class='panel panel-default'>" +
							  		"<div class='panel-heading'>" +
							  			"<div class='row'>" +
							  				"<div class='col-md-8'>" +
							  					"<h3 class='panel-title'>" +
							 						Watch.title +
							  					"</h3>" +
							  				"</div>" +
							  				"<div class='col-md-4 text-center'>" +
							  					"<button type='button' class='btn btn-default glyphicon glyphicon-pencil' data-toggle='modal' data-target='#notesModal' onclick='fillModal(" + Watch.id + ")'>" +
							  						" Notes" +
							  					"</button>" +
							  				"</div>" +
							  			"</div>" +
							  		"</div>" +
							  		"<div class='panel-body'>" +
							  			"<h2 class='text-center' + id='watch" + Watch.id +"'>" +
							 				GiveTimeString(Watch.curTime - Watch.startTime) +
							  			"</h2>" +
							  		"</div>" +
							  		"<div class='panel-footer'>" +
							  			"<div class='btn-group btn-group-justified'>" +
							  				"<span class='btn btn-warning glyphicon glyphicon-pause' onclick='PausePlayToggle(this, " + Watch.id + ")'>Pause</span>" +
											"<span class='btn btn-info glyphicon glyphicon-refresh' onclick='RestartClock(" + Watch.id + ")'>Restart</span>" +
											"<span class='btn btn-danger glyphicon glyphicon-remove' onclick='RemoveOne(" + Watch.id + ")'>Remove</span>" +
										"<!/div>" +
									"</div>" +
								"</div>" +
							  "</div>";
				
				return retStr;
			}
	    	
	    	//creates a watch object
	    	function Watch(id, status = 0, title, startTime) {
	    		this.id = id;
	    		this.status = status; // 0 -> pause state 1 -> play state
	    		this.title = title;
	    		this.startTime = startTime;
	    		this.curTime = startTime;
	    		this.notes = [];
	    	}

	    	//adds watch to DOM
	    	function AddWatch() {
	    		listStopWatch[listStopWatch.length] = new Watch(idCounter, 1, document.getElementById('title').value, Date.now());
	    		idCounter = idCounter + 1;
	    		$("#stopwatches").append(StopWatchBody(listStopWatch[listStopWatch.length - 1]));
	    		document.getElementById('title').value = '';
	    	}

	    	function ShowList() {
	    		console.log(listStopWatch);
	    		// for(var i = 0; i < listStopWatch.length; i++) {
	    		// 	console.log(listStopWatch[i].title);
	    		// }
	    	}

	    	//removes a single clock when called
	    	function RemoveOne(id) {
	    		document.getElementById(id).outerHTML = '';
	    		for(var i = 0; i < listStopWatch.length; i++) {
	    			if(listStopWatch[i].id == id) {
	    				listStopWatch.splice(i, 1);
	    				break;
	    			}
	    		}
	    	}

	    	//restarts the time for one clock
	    	function RestartClock(id) {
	    		for(var i = 0; i < listStopWatch.length; i++) {
	    			if(listStopWatch[i].id == id) {
	    				listStopWatch[i].startTime = Date.now();
	    				listStopWatch[i].curTime = Date.now();
	    				document.getElementById('watch' + id).innerHTML = GiveTimeString(0);
	    			}
	    		}
	    	}

	    	//for pause play
	    	function PausePlayToggle(elem, id) {
	    		if(elem.innerHTML == 'Pause') {
	    			elem.outerHTML = "<span class='btn btn-success glyphicon glyphicon-play' onclick='PausePlayToggle(this, " + id + ")'>Play</span>"
	    			for(var i = 0; i < listStopWatch.length; i++) {
	    				if(listStopWatch[i].id == id) {
	    					listStopWatch[i].status = 0;
	    				}
	    			}
	    		}
	    		else if(elem.innerHTML == 'Play') {
	    			elem.outerHTML = "<span class='btn btn-warning glyphicon glyphicon-pause' onclick='PausePlayToggle(this, " + id + ")'>Pause</span>"
	    			for(var i = 0; i < listStopWatch.length; i++) {
	    				if(listStopWatch[i].id == id) {
	    					listStopWatch[i].status = 1;
	    				}
	    			}
	    		}
	    	}

	    	//removes all clocks
	    	function RemoveAll() {
	    		listStopWatch = [];
	    		idCounter = 1;
	    		$("#stopwatches").html('');
	    	}

	    	//updates the time in clocks
	    	function updateClocks() {
	    		for(var i = 0; i < listStopWatch.length; i++) {
	    			if(listStopWatch[i].status !== 0) {
	    				listStopWatch[i].curTime += 1;
	    				var tempId = 'watch' + listStopWatch[i].id;
	    				var tempModalId = 'note' + listStopWatch[i].id;
	    				document.getElementById(tempId).innerHTML = GiveTimeString(listStopWatch[i].curTime - listStopWatch[i].startTime);
	    				if(document.getElementById(tempModalId) !== null) {
	    					document.getElementById(tempModalId).innerHTML = GiveTimeString(listStopWatch[i].curTime - listStopWatch[i].startTime);
	    				}
	    			}
	    		}
	    	}

	    	function fillModal(id) {
	    		var watch = null;
	    		var retHtmlTitle = '';
	    		var retHtmlBody = '';
	    		var retHtmlFooter = '';

	    		for(var i = 0; i < listStopWatch.length; i++) {
	    			if(listStopWatch[i].id == id) {
	    				watch = listStopWatch[i];

	    			}
	    		}
	    		if(watch == null) {
	    			console.log('error');
	    		}

	    		retHtmlTitle = watch.title;

	    		retHtmlBody = retHtmlBody + 
	    						"<h2 class='text-center' + id='note" + watch.id +"'>" +
							 		GiveTimeString(watch.curTime - watch.startTime) +
							  	"</h2>" +
							  	"<hr>";

				for(var i = 0; i < watch.notes.length; i++) {
					retHtmlBody += "<p>" +
									watch.notes[i] +
									"</p>";
				}

				retHtmlFooter += "<div class='input-group'>" +
									"<input type='text' class='form-control' id='exampleInputName2' placeholder='Write Note' />" +
										"<div class='input-group-btn'>" +
											"<span class='btn btn-primary glyphicon glyphicon-plus'> Add Note</span>" +
										"</div>" +
								"</div>";


	    		$('#notesModalTitle').html(retHtmlTitle);
	    		$('#notesModalBody').html(retHtmlBody);
	    		$('#notesModalFooter').html(retHtmlFooter);
	    	}

	    	setInterval(updateClocks, 1000);
    	</script>
    </head>
	
	<!-- Modal for showing Notes-->
	<div class="modal fade" id="notesModal" tabindex="-1" role="dialog" aria-labelledby="notesModalTitle">
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="notesModalTitle">to be filled by function</h4>
	      </div>
	      <div class="modal-body" id="notesModalBody">
	        <p> to be filled by function</p>
	      </div>
	      <hr>
      	  <div class="modal-footer" id="notesModalFooter">
      		<p> to be filled by function </p>
      	  </div>
	    </div>
	  </div>
	</div>


    <body class='container'>
	    <div class="row">
	    <div class="container-fluid">
	    	<h1 class="page-header text-center"> Multi Stop Watch </h1>
	    	<div class="input-group">
	    		<input id='title' type='text' class="form-control" placeholder="Enter title for StopWatch"/>
	    		<span class="input-group-btn">
	    			<p onclick="AddWatch()" class="form-control btn btn-primary"><span class="glyphicon glyphicon-plus"></span> Add stopwatch </p>
	    		</span>
	    	</div>
		</div>	
		</div>
		<hr>
	    
	    <!--container for Stopwatches -->
    	<div class="row" id="stopwatches">
 
	    </div>
		
		<hr>
	    <div class="row">
	    	<p class="col-md-offset-5 btn btn-danger btn-lg" onclick="RemoveAll()"><span class="glyphicon glyphicon-remove"></span>REMOVE ALL</p>
	    </div>
	    	
    </body>

</html>
